# 서비스 생성하기

객체는 크게 두 종류가 있다.

- 작업을 수행하거나 정보를 반환하는 `서비스` 객체
- 데이터를 담고 있으며, 그 데이터를 조작하거나 가져오는 행위를 선택적으로 드러내는 객체

첫 번째 객체를 `서비스(Service)` 라고 부른다. 자바 웹 개발자들은 서비스가 무엇인지 쉽게 알 것이다. 한 번 생성되면 여러 번 사용하지만 자신은 바꿀 수 없다.
여기서 중요한 포인트가 __"자신은 바꿀 수 없다"__ 라는 부분인데, 해당 객체에 상태값을 갖게 해서는 안된다는 의미이다.

두 번째 객체는 첫 번째 객체를 사용해서 자신의 작업을 완료한다. 이러한 객체는 서비스가 작동할 때 함께하는 재료이다. `재료 객체` 라고도 한다.
따라서 생명주기가 서비스 객체보다 복잡하다.

서비스 객체의 함수에서 어떤 기능을 처리할 때 다른 서비스의 객체나 리포지토리 객체가 필요한 경우가 있다. 이때 `의존성` 주입을 해야하는데, 의존성 주입은 `생성자 주입`으로 하는 것이 좋다.

## 전용 설정 객체 : 짝 지은 설정값은 함께 두기

서비스에는 전역 설정 객체 전체가 아니라 필요한 값만 주입해야 한다. 그런데 어떤 값들은 항상 붙어다니기 때문에, 따로따로 주입하면 응집력을 망가뜨린다. 대표적인 예가 `자격 증명`이다.
id, pw 는 항상 같이 붙어 다닌다.

```java
public class UserService {
  private String id;
  private String pw;
  
  public UserService(String id, String pw) {
    this.id = id;
    this.pw = pw;
  }
  
  // 생략
}
```

위 처럼 하는 것보다 `전용 설정 객체`를 도입해서 함께 두는 것이 낫다.

```java
public class Credentials {
  private String id;
  private String pw;
  
  // 생략
}

public class UserService {
  private Credentials credentials;
  
  public UserService(Credentials credentials) {
    this.credentials = credentials;
  }
  
  // 생략
}
```

## 모든 생성자 인수는 필수

때로는 의존성을 필수가 아닌 선택으로 두고 싶을 수도 있다. 예를들면 로그 남기는 것을 부차적인 관심사로 간주할 수 있다.

하지만, 이렇게하면 로그를 사용하는 곳에서 Logger 인스턴스를 정말로 제공했는지 instanceof 코드가 필요해지고, 코드가 지저분해질 것이다.

## 생성자 주입만 사용

설정자(setter)를 사용한 의존성 주입을 생각해 볼 수도 있는데, 설정자 주입을 사용하게 되면 코드도 복잡해질 뿐만 아니라 다음과 같은 문제가 있다.

- 객체를 불완전한 상태(incomplete state)로 생성할 수 없어야 한다.
- 서비스는 불변이어야 한다. 즉, 인스턴스 생성을 마친 후에는 바꿀 수 없어야 한다.

## 선택적인 의존성 같은 건 없다.

의존성은 필요하거나 그렇지 않거나 둘 중 하나이다.

## 모든 의존성을 명시한다.

예를 들어 정적(static) 의존성을 사용하는 경우도 있다. 이러한 경우에는 객체 의존성(우리가 흔히 아는 생성자 주입 방법)으로 바꾸어서 모든 의존성을 명시하도록 해주는 것도 좋은 방법이다.

## 서비스 인스턴스를 만든 후에는 행위를 바꾸지 못하게 한다.

즉, 상태값을 갖게 하면 안된다. (생성 후 변경 불가능해야 하며, 어떤 메서드를 호출하던간에 그 행위가 변경되서는 안 된다.)

서비스의 인스턴스를 만든 후 선택적인 의존성을 주입하면 서비스의 행위를 바꾸게 된다. 이는 서비스를 예측할 수 없게 한다. __웹 응용 프로그램 개발한에서는 변경 가능한 서비스가 정말 필요 없다.__
반면, 웹 기반이 아닌 응용 프로그램에서는 생성 후 수신자나 구독자를 추가, 삭제할 수 있는 이벤트 디스패처 같은 서비스가 필요할 수 있다.

## 인자가 유효하지 않으면 예외를 발생 시킨다.

생성자 안에서 예외를 일으키면 유효하지 않은 인자를 바탕으로 객체를 생성하지 않을 수 있다. 

> 사용자 정의 예외를 일으키는 대신, 메서드와 생성자 인자 유효성을 확인하는 데에는 재사용 가능한 단언 함수(Assert Function)를 사용하는 게 꽤 일반적이다.
